package org.osre;

import org.osre.*;

import java.io.*;

public class Vulnerability {

    double [] parameter = new double[4];
    double start;
    double end;
    int asset;
    int measure;
    boolean lnFlag = false;
    
    public Vulnerability(int a, int m) {
	asset = a;
	measure = m;
    }  
    
    public void setParameter() {
	parameter = this.makeParameter();
    }

    public double[][] makeVulMedian() {

	double [] step = new double[1001];
	double [] vulmedian = new double[1001];
	double [][] vul = new double[1001][2];
	int negativeCounter = 0;
	double temp;

	this.setParameter();
	if(parameter[0]==999) lnFlag = true;

	MakeStep2 hazStep = new MakeStep2(measure);
	step = hazStep.getStep();

	for (int i=0; i<1001; i++) {
	    if(lnFlag==true) {
		vulmedian[i] = this.calcLnVulMedian(step[i]);
	    }
	    else {
		vulmedian[i] = this.calcVulMedian(step[i]);
	    }
	    vul[i][0] = step[i];
	    vul[i][1] = vulmedian[i];

	    if(vul[i][1] > 0 && negativeCounter > 0) {

		System.out.println("neg"+negativeCounter);

		temp = vul[i][1]/(negativeCounter+1);
		vul[0][1] = temp;

		System.out.println("temp" + temp);

		for(int j=1;j<negativeCounter+1;j++) {
		    vul[j][1] = vul[j-1][1] + temp;
		}
		negativeCounter = 0;
	    }

	    if(vul[i][1] < 0) negativeCounter++;
	   		
	    if(i>0 && vul[i][1] < vul[i-1][1]) {
		vul[i][1] = vul[i-1][1];
	    }

	}
	lnFlag = false;
	return vul;
    }

    public double[] makeParameter() {
	
	double[] para = new double[4];
	double[][] thisAreaParameter = new double[92][4];

	VulParameter vulPara = new VulParameter();
	thisAreaParameter = vulPara.getParameter(asset,measure);

	para[0] = thisAreaParameter[asset-1][0];
	para[1] = thisAreaParameter[asset-1][1];
	para[2] = thisAreaParameter[asset-1][2];
	para[3] = thisAreaParameter[asset-1][3];
       
	return para;
    }
 
    public double calcVulMedian(double x) {
	double y;
	y = parameter[0]*Math.pow(x,3)+parameter[1]*Math.pow(x,2)
	    +parameter[2]*x+parameter[3];
	return y;
    }
    public double calcLnVulMedian(double x) {
	double y;
	y = parameter[2]*Math.log(x)+parameter[3];
	return y;
    }

}

